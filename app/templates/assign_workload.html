{% extends "base.html" %} {% block title %}Assign Workload{% endblock %} {%
block content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/base.css') }}"
/>
<link 
rel="stylesheet" 
href="{{ url_for('static', filename='css/view_workload.css') }}"
/>
<div class="container mt-5">
  <!-- Workload Assignment Section -->
  <h3>Workload Assignment [HoS only]</h3>
  <div class="assignmentContainer">
    <div class="row mt-2 assignmentRow">
      <div class="col-2">
        <label class="form-label">Assignment No.</label>
        Assignment 1
      </div>
      <div class="col">
        <label for="department" class="form-label">Department</label>
        <select class="form-select" id="department">
          {% for dept in ["CSSE", "M&S", "Physics"] %}
          <option value="{{ dept }}">{{ dept }}</option>
          {% endfor %}
          <!-- 
          For MySQL data fetching:
          {% for dept in departments_from_database %}
          <option value="{{ dept.id }}">{{ dept.name }}</option>
          {% endfor %}
          -->
        </select>
      </div>
      <div class="col-2">
        <label for="taskType" class="form-label">Task Type</label>
        <select class="form-select" id="taskType">
          {% for task in ["Uni Coordination", "Project Supervision",
          "Administration"] %}
          <option value="{{ task }}">{{ task }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <label for="taskName" class="form-label">Task Name</label>
        <input type="text" class="form-control" id="taskName" required />
        <small class="form-text text-danger" style="display: none"
          >Invalid input</small
        >
      </div>
      <div class="col">
        <label for="staffName" class="form-label">Staff Name</label>
        <select class="form-select" id="staffName">
          <option value="Mary">Mary</option>
          <option value="Tom">Tom</option>
          <option value="John">John</option>
        </select>
      </div>
      <div class="col-2">
        <label for="assignedHours" class="form-label">Assigned Hours</label>
        <input type="text" class="form-control" id="assignedHours" />
        <small class="form-text text-danger" style="display: none"
          >Invalid input</small
        >
      </div>
      <div class="col d-flex align-items-end">
        <button class="btn btn-primary me-2">Assign</button>
      </div>
    </div>
    <button
      class="btn btn-secondary mt-3 d-grid gap-2 col-6 mx-auto"
      onclick="addAssignmentRow()"
    >
      Add Assignment
    </button>
  </div>

<!-- File Upload Section -->
<h3 class="mt-5">File Upload [HoS / HoDs / Admin]</h3>
<div class="uploadContainer">
  <form action="/upload" method="POST" enctype="multipart/form-data">
    <div class="row mt-2 uploadRow">
      <div class="col-4">
        <label for="uploadFile" class="form-label">Upload File</label>
        <input
          type="file"
          name="file"
          class="form-control"
          id="uploadFile"
          accept=".xlsx, .xls, .csv, .tsv"
        />
        <small class="form-text text-danger" style="display: none"
          >Invalid file type</small
        >
      </div>
      <div class="col d-flex align-items-end">
        <button type="submit" class="btn btn-primary me-2">Upload</button>
      </div>
    </div>
  </form>
  <button
    class="btn btn-secondary mt-3 d-grid gap-2 col-6 mx-auto"
    onclick="addUploadRow()"
  >
    Add File
  </button>
</div>


<script>
  let asgNumber = 1;

  function addAssignmentRow() {
    // Increment the assignment number
    asgNumber += 1;

    // Define the new row's HTML content
    let newRowHTML = `
      <div class="row mt-2 assignmentRow">
        <div class="col-2">
          Assignment ${asgNumber}
        </div>
        <div class="col">
          <select class="form-select" id="department">
            {% for dept in ["CSSE", "M&S", "Physics"] %}
            <option value="{{ dept }}">{{ dept }}</option>
            {% endfor %}
            <!-- 
            For MySQL data fetching:
            {% for dept in departments_from_database %}
            <option value="{{ dept.id }}">{{ dept.name }}</option>
            {% endfor %}
            -->
          </select>
        </div>
        <div class="col-2">
          <select class="form-select" id="taskType">
            {% for task in ["Uni Coordination", "Project Supervision",
            "Administration"] %}
            <option value="{{ task }}">{{ task }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-2">
          <input type="text" class="form-control" id="taskName" required />
          <small class="form-text text-danger" style="display: none"
            >Invalid input</small
          >
        </div>
        <div class="col">
          <select class="form-select" id="staffName">
            <option value="Mary">Mary</option>
            <option value="Tom">Tom</option>
            <option value="John">John</option>
          </select>
        </div>
        <div class="col-2">
          <input
            type="text"
            class="form-control"
            id="assignedHours"
          />
          <small class="form-text text-danger" style="display: none"
            >Invalid input</small
          >
        </div>
        <div class="col d-flex align-items-end">
          <button class="btn btn-primary me-2">Assign</button>
          <button class="btn btn-danger me-2" onclick="removeAsgRow(this)">
            Remove
          </button>
        </div>
      </div>
    `;

    // Get the last assignment row
    let assignmentRows = document.querySelectorAll(".assignmentRow");
    let lastRow = assignmentRows[assignmentRows.length - 1];

    // Add the new row below the last row
    lastRow.insertAdjacentHTML("afterend", newRowHTML);
  }

  function removeAsgRow(btnElement) {
    asgNumber -= 1;
    let row = btnElement.closest(".row");
    row.remove();
  }

  let sprNumber = 1;

  function addUploadRow() {
    // Increment the spreadsheet number
    sprNumber += 1;

    // Define the new row's HTML content
    let newRowHTML = `
      <div class="row mt-2 uploadRow">
        <div class="col-2">
          Spreadsheet ${sprNumber}
        </div>
        <div class="col-4">
          <input type="file" class="form-control" accept=".xlsx, .xls, .csv, .tsv">
        </div>
        <div class="col d-flex align-items-end">
          <button class="btn btn-primary me-2">Upload</button>
          <button class="btn btn-danger me-2" onclick="removeSprRow(this)">
            Remove
          </button>
        </div>
      </div>
    `;

    // Get the last upload row
    let uploadRows = document.querySelectorAll(".uploadRow");
    let lastRow = uploadRows[uploadRows.length - 1];

    // Add the new row below the last row
    lastRow.insertAdjacentHTML("afterend", newRowHTML);
  }

  function removeSprRow(btnElement) {
    sprNumber -= 1;
    let row = btnElement.closest(".row");
    row.remove();
  }
</script>

{% endblock %}
